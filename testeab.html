<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGD-A | Gestão de Demandas</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .sebrae-blue { color: #005CA9; }
        .sebrae-bg { background-color: #005CA9; }
        
        /* Calendar Specific Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb; /* border color */
        }
        .calendar-cell {
            background-color: white;
            min-height: 140px;
        }
        .calendar-event {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // --- MOCK DATA ---
        
        // 1. MOCK RECURSOS (Atualizado com campo 'area')
        const INITIAL_RECURSOS = [
            { id: 1, nome: "Cozinha Industrial Completa", tipo: "Infraestrutura", area: "Alimentos e Bebidas", descricao: "Bancadas de inox, pia dupla, exaustão." },
            { id: 2, nome: "Batedeira Planetária", tipo: "Equipamento", area: "Alimentos e Bebidas", ni: "PAT-00123", quantidade: 5, observacoes: "Manutenção preventiva em dez/25" },
            { id: 3, nome: "Projetor Multimídia", tipo: "Equipamento", area: "Geral", ni: "PAT-00555", quantidade: 2, observacoes: "Acompanha cabo HDMI" },
            { id: 4, nome: "Farinha de Trigo", tipo: "Insumo", area: "Alimentos e Bebidas", descricao: "Tipo 1", unidadeMedida: "Kg", quantidade: 50 },
            { id: 5, nome: "Laboratório de Informática", tipo: "Infraestrutura", area: "Geral", descricao: "Mínimo 10 computadores com acesso à internet." },
            { id: 6, nome: "Chocolate Meio Amargo", tipo: "Insumo", area: "Alimentos e Bebidas", descricao: "Barra de 1kg", unidadeMedida: "Unidade", quantidade: 20 },
            { id: 7, nome: "Kit Solda (Máscara + Luva)", tipo: "Equipamento", area: "Metalurgia", ni: "S/N (Consumível)", quantidade: 15, observacoes: "Verificar validade do CA" }
        ];

        // 2. MOCK CURSOS 
        const INITIAL_CURSOS = [
            { id: 1, titulo: "Fabricação De Ovos De Páscoa E Bombons", area: "Alimentos e Bebidas", ch: 20, recursosIds: [1, 2, 4, 6] },
            { id: 2, titulo: "Boas Práticas De Fabricação", area: "Alimentos e Bebidas", ch: 20, recursosIds: [3] },
            { id: 3, titulo: "Fabricação De Pizzas E Salgados Assados", area: "Alimentos e Bebidas", ch: 60, recursosIds: [1, 4] },
            { id: 4, titulo: "Técnicas Básicas Em Serralheria", area: "Metalurgia", ch: 80, recursosIds: [7] },
            { id: 5, titulo: "Instalação De Dispositivos Eletroeletrônicos", area: "Eletroeletrônica", ch: 40, recursosIds: [3, 5] },
            { id: 6, titulo: "Conferente De Carga E Descarga", area: "Logística", ch: 60, recursosIds: [3] },
            { id: 7, titulo: "Instalação Elétrica Residencial", area: "Construção Civil", ch: 40, recursosIds: [3] }
        ];

        // 3. MOCK DOCENTES
        const INITIAL_DOCENTES = [
            { id: 1, nome: "Hildo", area: "Alimentos e Bebidas", contrato: "Horista", diasSemana: ["Seg", "Qua", "Sex"], horaInicio: "18:00", horaFim: "22:00" },
            { id: 2, nome: "Ana Silva", area: "Alimentos e Bebidas", contrato: "CLT", diasSemana: ["Seg", "Ter", "Qua", "Qui", "Sex"], horaInicio: "08:00", horaFim: "17:00" },
            { id: 3, nome: "Escola Móvel 1060", area: "Construção Civil", contrato: "Recurso Móvel", diasSemana: ["Seg", "Ter", "Qua", "Qui", "Sex"], horaInicio: "08:00", horaFim: "17:00" },
            { id: 4, nome: "Carlos Souza", area: "Metalurgia", contrato: "Prestador", diasSemana: ["Ter", "Qui"], horaInicio: "13:00", horaFim: "18:00" },
            { id: 5, nome: "Mariana Logistics", area: "Logística", contrato: "Horista", diasSemana: ["Sáb"], horaInicio: "08:00", horaFim: "12:00" }
        ];

        // 4. MOCK DEMANDAS
        const INITIAL_DEMANDAS = [
            { id: "D-2025-001", curso: "Fabricação De Ovos De Páscoa E Bombons", solicitante: "Herith", municipio: "Maracaí", status: "Solicitado", dataInicio: "2025-03-17", dataTermino: "2025-03-24", horaInicio: "13:00", horaFim: "17:00", diasSemana: ["Seg", "Qua", "Sex"], docente: "Hildo" },
            { id: "D-2025-002", curso: "Técnicas Básicas Em Serralheria", solicitante: "Patricia", municipio: "Rinopolis", status: "Em Análise", dataInicio: "2025-07-07", dataTermino: "2025-07-18", horaInicio: "18:00", horaFim: "22:00", diasSemana: ["Seg", "Ter", "Qua", "Qui", "Sex"], docente: null },
            { id: "D-2025-003", curso: "Instalação Elétrica Residencial", solicitante: "Patricia", municipio: "Rinopolis", status: "Programado", dataInicio: "2025-04-22", dataTermino: "2025-05-07", horaInicio: "18:00", horaFim: "22:00", diasSemana: ["Sáb"], docente: "Escola Móvel 1060" },
        ];

        const MOCK_SOLICITANTES = ["Herith", "Patricia", "Mariana", "Sebrae Regional"];
        const MOCK_MUNICIPIOS = ["Maracaí", "Rinopolis", "Julio Mesquita", "Assis", "Ourinhos"];
        const DAYS_OPTIONS = ["Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"];
        const AREAS_TECNOLOGICAS = ["Alimentos e Bebidas", "Metalurgia", "Logística", "Construção Civil", "Eletroeletrônica", "Automotiva", "Gestão", "TI", "Geral"];

        // --- HELPERS ---
        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
        const MONTH_NAMES = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        const isDateInRange = (checkDateStr, startStr, endStr) => {
            if (!startStr) return false;
            const check = new Date(checkDateStr); check.setHours(12,0,0,0); 
            const start = new Date(startStr); start.setHours(12,0,0,0);
            const end = endStr ? new Date(endStr) : new Date(startStr); end.setHours(12,0,0,0);
            return check >= start && check <= end;
        };

        // --- COMPONENTS ---

        const Button = ({ children, onClick, variant = 'primary', className = '', type = 'button' }) => {
            const baseStyle = "px-4 py-2 rounded-md font-medium transition-colors flex items-center gap-2 text-sm";
            const variants = {
                primary: "bg-blue-700 text-white hover:bg-blue-800",
                secondary: "bg-white text-gray-700 border border-gray-300 hover:bg-gray-50",
                danger: "bg-red-600 text-white hover:bg-red-700",
                ghost: "text-gray-600 hover:bg-gray-100",
            };
            return <button type={type} onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`}>{children}</button>;
        };

        const StatusBadge = ({ status }) => {
            const styles = {
                'Solicitado': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                'Em Análise': 'bg-blue-100 text-blue-800 border-blue-200',
                'Programado': 'bg-green-100 text-green-800 border-green-200',
                'Cancelado': 'bg-red-100 text-red-800 border-red-200',
                'Realizado': 'bg-gray-100 text-gray-800 border-gray-200'
            };
            return <span className={`text-xs px-2 py-1 rounded-full font-semibold border ${styles[status] || styles['Solicitado']}`}>{status}</span>;
        };

        const Modal = ({ isOpen, onClose, title, children, footer }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl overflow-hidden animate-fade-in-up flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center p-5 border-b border-gray-200 flex-shrink-0">
                            <h3 className="text-lg font-bold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600"><i data-lucide="x" className="w-6 h-6"></i></button>
                        </div>
                        <div className="p-6 overflow-y-auto flex-1 custom-scrollbar">{children}</div>
                        {footer && <div className="p-5 border-t border-gray-200 bg-gray-50 flex justify-end gap-3 flex-shrink-0">{footer}</div>}
                    </div>
                </div>
            );
        };

        // --- MÓDULOS DE VISUALIZAÇÃO ---

        // 1. Módulo de Recursos (ATUALIZADO)
        const RecursosView = ({ recursos, onAdd, onEdit }) => (
            <div className="animate-fade-in">
                <div className="flex justify-between items-center mb-6">
                    <div>
                        <h2 className="text-2xl font-bold text-gray-800">Gestão de Recursos</h2>
                        <p className="text-gray-500">Infraestrutura, Equipamentos e Insumos.</p>
                    </div>
                    <Button onClick={onAdd} variant="primary"><i data-lucide="plus" className="w-4 h-4"></i> Novo Recurso</Button>
                </div>
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <table className="w-full text-left border-collapse">
                        <thead className="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
                            <tr>
                                <th className="p-4 font-semibold">Item</th>
                                <th className="p-4 font-semibold">Área</th>
                                <th className="p-4 font-semibold">Tipo</th>
                                <th className="p-4 font-semibold">Detalhes</th>
                                <th className="p-4 font-semibold text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100 text-sm">
                            {recursos.map((r) => (
                                <tr key={r.id} className="hover:bg-gray-50">
                                    <td className="p-4 font-medium text-gray-900">{r.nome}</td>
                                    <td className="p-4">
                                        <span className="px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200">
                                            {r.area}
                                        </span>
                                    </td>
                                    <td className="p-4">
                                        <span className={`px-2 py-1 rounded text-xs font-medium border 
                                            ${r.tipo === 'Infraestrutura' ? 'bg-purple-50 text-purple-700 border-purple-100' : 
                                              r.tipo === 'Equipamento' ? 'bg-orange-50 text-orange-700 border-orange-100' : 
                                              'bg-teal-50 text-teal-700 border-teal-100'}`}>
                                            {r.tipo}
                                        </span>
                                    </td>
                                    <td className="p-4 text-xs text-gray-600">
                                        {r.tipo === 'Infraestrutura' && <div className="truncate max-w-xs" title={r.descricao}>{r.descricao}</div>}
                                        {r.tipo === 'Equipamento' && (
                                            <div>
                                                <span className="font-semibold">NI:</span> {r.ni || 'N/A'} <br/>
                                                <span className="font-semibold">Qtd:</span> {r.quantidade}
                                            </div>
                                        )}
                                        {r.tipo === 'Insumo' && (
                                            <div>
                                                <span className="font-semibold">Qtd:</span> {r.quantidade} {r.unidadeMedida} <br/>
                                                <span className="text-gray-400">{r.descricao}</span>
                                            </div>
                                        )}
                                    </td>
                                    <td className="p-4 text-right">
                                        <button onClick={() => onEdit(r)} className="p-1.5 text-gray-500 hover:text-blue-600"><i data-lucide="edit-2" className="w-4 h-4"></i></button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // 2. Módulo de Cursos (ATUALIZADO: Exibição resumida de tipos)
        const CursosView = ({ cursos, recursos, onAdd, onEdit }) => (
            <div className="animate-fade-in">
                <div className="flex justify-between items-center mb-6">
                    <div>
                        <h2 className="text-2xl font-bold text-gray-800">Catálogo de Cursos</h2>
                        <p className="text-gray-500">Gerencie o portfólio e checklists de validação.</p>
                    </div>
                    <Button onClick={onAdd} variant="primary"><i data-lucide="plus" className="w-4 h-4"></i> Novo Curso</Button>
                </div>
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <table className="w-full text-left border-collapse">
                        <thead className="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
                            <tr>
                                <th className="p-4 font-semibold">Título do Curso</th>
                                <th className="p-4 font-semibold">Área Tecnológica</th>
                                <th className="p-4 font-semibold">Carga Horária</th>
                                <th className="p-4 font-semibold">Categorias Exigidas</th>
                                <th className="p-4 font-semibold text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100 text-sm">
                            {cursos.map((c) => {
                                // Identificar tipos de recursos associados
                                const linkedResources = (c.recursosIds || []).map(id => recursos.find(r => r.id === id)).filter(Boolean);
                                const hasInfra = linkedResources.some(r => r.tipo === 'Infraestrutura');
                                const hasEquip = linkedResources.some(r => r.tipo === 'Equipamento');
                                const hasInsumo = linkedResources.some(r => r.tipo === 'Insumo');
                                
                                return (
                                    <tr key={c.id} className="hover:bg-gray-50">
                                        <td className="p-4 font-medium text-gray-900">{c.titulo}</td>
                                        <td className="p-4 text-gray-600"><span className="bg-indigo-50 text-indigo-700 px-2 py-1 rounded text-xs border border-indigo-100">{c.area}</span></td>
                                        <td className="p-4 text-gray-600">{c.ch} horas</td>
                                        <td className="p-4">
                                            <div className="flex gap-2">
                                                {hasInfra && <span title="Infraestrutura" className="w-6 h-6 rounded-full bg-purple-100 text-purple-700 flex items-center justify-center text-xs"><i data-lucide="building" className="w-3 h-3"></i></span>}
                                                {hasEquip && <span title="Equipamentos" className="w-6 h-6 rounded-full bg-orange-100 text-orange-700 flex items-center justify-center text-xs"><i data-lucide="wrench" className="w-3 h-3"></i></span>}
                                                {hasInsumo && <span title="Insumos" className="w-6 h-6 rounded-full bg-teal-100 text-teal-700 flex items-center justify-center text-xs"><i data-lucide="box" className="w-3 h-3"></i></span>}
                                                {!hasInfra && !hasEquip && !hasInsumo && <span className="text-gray-400 text-xs italic">N/A</span>}
                                            </div>
                                        </td>
                                        <td className="p-4 text-right">
                                            <button onClick={() => onEdit(c)} className="p-1.5 text-gray-500 hover:text-blue-600"><i data-lucide="edit-2" className="w-4 h-4"></i></button>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // 3. Módulo de Docentes
        const DocentesView = ({ docentes, onAdd, onEdit }) => (
            <div className="animate-fade-in">
                <div className="flex justify-between items-center mb-6">
                    <div>
                        <h2 className="text-2xl font-bold text-gray-800">Base de Docentes</h2>
                        <p className="text-gray-500">Gerencie instrutores e recursos móveis.</p>
                    </div>
                    <Button onClick={onAdd} variant="primary"><i data-lucide="plus" className="w-4 h-4"></i> Novo Docente</Button>
                </div>
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <table className="w-full text-left border-collapse">
                        <thead className="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
                            <tr>
                                <th className="p-4 font-semibold">Nome</th>
                                <th className="p-4 font-semibold">Área de Atuação</th>
                                <th className="p-4 font-semibold">Tipo Contrato</th>
                                <th className="p-4 font-semibold">Disponibilidade</th>
                                <th className="p-4 font-semibold text-right">Ações</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-gray-100 text-sm">
                            {docentes.map((d) => (
                                <tr key={d.id} className="hover:bg-gray-50">
                                    <td className="p-4 font-medium text-gray-900 flex items-center gap-2">
                                        <div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 text-xs font-bold">{d.nome.substring(0,2).toUpperCase()}</div>
                                        {d.nome}
                                    </td>
                                    <td className="p-4 text-gray-600">{d.area}</td>
                                    <td className="p-4 text-gray-600">{d.contrato}</td>
                                    <td className="p-4 text-gray-600 text-xs">
                                        {d.diasSemana && d.diasSemana.length > 0 ? (
                                            <div className="flex flex-col">
                                                <span className="font-medium text-gray-700">{d.diasSemana.join(', ')}</span>
                                                <span className="text-gray-400">{d.horaInicio} - {d.horaFim}</span>
                                            </div>
                                        ) : <span className="text-gray-400 italic">Não informada</span>}
                                    </td>
                                    <td className="p-4 text-right">
                                        <button onClick={() => onEdit(d)} className="p-1.5 text-gray-500 hover:text-blue-600"><i data-lucide="edit-2" className="w-4 h-4"></i></button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // 4. Módulo de Demandas (Calendário + Lista)
        const DemandasView = ({ demandas, openModal, viewMode, setViewMode, onEventClick }) => {
             // Calendar Logic
            const [currentDate, setCurrentDate] = useState(new Date(2025, 2, 1));
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = getDaysInMonth(year, month);
            const firstDay = getFirstDayOfMonth(year, month);
            
            const getEventsForDay = (day) => {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                return demandas.filter(d => isDateInRange(dateStr, d.dataInicio, d.dataTermino));
            };

            return (
                <div className="animate-fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800">Gestão de Demandas</h2>
                            <p className="text-gray-500">Planejamento e Acompanhamento</p>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="flex bg-white rounded-lg shadow-sm border border-gray-200 p-1">
                                <button onClick={() => setViewMode('list')} className={`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition-colors ${viewMode === 'list' ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-50'}`}><i data-lucide="list" className="w-4 h-4"></i> Lista</button>
                                <button onClick={() => setViewMode('calendar')} className={`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition-colors ${viewMode === 'calendar' ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-50'}`}><i data-lucide="calendar" className="w-4 h-4"></i> Calendário</button>
                            </div>
                            <div className="h-6 w-px bg-gray-300 mx-2"></div>
                            <Button onClick={() => openModal('create_demanda')} variant="primary"><i data-lucide="plus" className="w-4 h-4"></i> Nova Demanda</Button>
                        </div>
                    </div>

                    {viewMode === 'list' ? (
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
                                    <tr>
                                        <th className="p-4 font-semibold">Curso</th>
                                        <th className="p-4 font-semibold">Solicitante</th>
                                        <th className="p-4 font-semibold">Local</th>
                                        <th className="p-4 font-semibold">Período</th>
                                        <th className="p-4 font-semibold">Status</th>
                                        <th className="p-4 font-semibold text-right">Ações</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100 text-sm">
                                    {demandas.map((demanda) => (
                                        <tr key={demanda.id} className="hover:bg-gray-50">
                                            <td className="p-4 font-medium text-gray-900">{demanda.curso}</td>
                                            <td className="p-4 text-gray-600">{demanda.solicitante}</td>
                                            <td className="p-4 text-gray-600">{demanda.municipio}</td>
                                            <td className="p-4 text-gray-600 text-xs">
                                                {new Date(demanda.dataInicio).toLocaleDateString('pt-BR')} a {new Date(demanda.dataTermino).toLocaleDateString('pt-BR')}
                                                {demanda.diasSemana && <div className="mt-1 text-gray-400">{demanda.diasSemana.join(', ')}</div>}
                                            </td>
                                            <td className="p-4"><StatusBadge status={demanda.status} /></td>
                                            <td className="p-4 text-right">
                                                <button onClick={() => openModal('edit_demanda', demanda)} className="p-1.5 text-gray-500 hover:text-blue-600"><i data-lucide="edit-2" className="w-4 h-4"></i></button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    ) : (
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                             <div className="p-4 flex justify-between items-center border-b border-gray-200">
                                <div className="flex items-center gap-4">
                                    <h3 className="text-lg font-bold text-gray-800">{MONTH_NAMES[month]} {year}</h3>
                                    <div className="flex gap-1">
                                        <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-1 hover:bg-gray-100 rounded"><i data-lucide="chevron-left" className="w-5 h-5 text-gray-600"></i></button>
                                        <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-1 hover:bg-gray-100 rounded"><i data-lucide="chevron-right" className="w-5 h-5 text-gray-600"></i></button>
                                    </div>
                                </div>
                                <Button onClick={() => setCurrentDate(new Date())} variant="secondary" className="text-xs py-1 h-8">Hoje</Button>
                            </div>
                            <div className="grid grid-cols-7 border-b border-gray-200 bg-gray-50">
                                {['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'].map(d => <div key={d} className="py-2 text-center text-xs font-semibold text-gray-500 uppercase">{d}</div>)}
                            </div>
                            <div className="calendar-grid">
                                {Array.from({ length: firstDay }).map((_, i) => <div key={`empty-${i}`} className="calendar-cell bg-gray-50"></div>)}
                                {Array.from({ length: daysInMonth }).map((_, i) => {
                                    const day = i + 1;
                                    const events = getEventsForDay(day);
                                    return (
                                        <div key={day} className="calendar-cell p-1.5 hover:bg-gray-50 flex flex-col relative border-t border-l border-transparent">
                                            <div className="text-right text-xs text-gray-400 mb-1">{day}</div>
                                            <div className="flex-1 overflow-y-auto custom-scrollbar flex flex-col gap-1">
                                                {events.map(ev => (
                                                    <button key={`${ev.id}-${day}`} onClick={() => onEventClick(ev)} className={`text-left p-1 rounded border text-[10px] leading-tight truncate ${ev.status === 'Programado' ? 'bg-green-50 border-green-200 text-green-900' : 'bg-blue-50 border-blue-200 text-blue-900'}`}>
                                                        {ev.curso}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );
        };


        // --- APP PRINCIPAL ---
        const App = () => {
            const [view, setView] = useState('demandas'); // 'demandas' | 'cursos' | 'docentes' | 'recursos'
            const [demandasViewMode, setDemandasViewMode] = useState('calendar');
            
            const [demandas, setDemandas] = useState(INITIAL_DEMANDAS);
            const [cursos, setCursos] = useState(INITIAL_CURSOS);
            const [docentes, setDocentes] = useState(INITIAL_DOCENTES);
            const [recursos, setRecursos] = useState(INITIAL_RECURSOS);

            const [modalConfig, setModalConfig] = useState({ isOpen: false, type: null, data: null });
            const [formData, setFormData] = useState({});

            useEffect(() => { lucide.createIcons(); }, [view, demandasViewMode, modalConfig]);

            // Generic Handlers
            const openModal = (type, data = null) => {
                setModalConfig({ isOpen: true, type, data });
                setFormData(data ? { ...data } : {});
                
                // Logic to init checkbox states based on existing data
                if (data && (type === 'edit_curso')) {
                    const existingIds = data.recursosIds || [];
                    const hasInfra = existingIds.some(id => recursos.find(r => r.id === id)?.tipo === 'Infraestrutura');
                    const hasEquip = existingIds.some(id => recursos.find(r => r.id === id)?.tipo === 'Equipamento');
                    const hasInsumo = existingIds.some(id => recursos.find(r => r.id === id)?.tipo === 'Insumo');
                    
                    setFormData(prev => ({ ...prev, catInfra: hasInfra, catEquip: hasEquip, catInsumo: hasInsumo }));
                }

                // Set defaults based on type
                if (!data) {
                    if (type === 'create_demanda') setFormData({ status: 'Solicitado', municipio: '', horaInicio: '08:00', horaFim: '12:00', diasSemana: [] });
                    if (type === 'create_curso') setFormData({ area: 'Alimentos e Bebidas', ch: 20, recursosIds: [], catInfra: false, catEquip: false, catInsumo: false });
                    if (type === 'create_docente') setFormData({ area: 'Metalurgia', contrato: 'Horista', horaInicio: '08:00', horaFim: '17:00', diasSemana: [] });
                    if (type === 'create_recurso') setFormData({ tipo: 'Infraestrutura', area: 'Geral' });
                }
            };

            const closeModal = () => {
                setModalConfig({ isOpen: false, type: null, data: null });
                setFormData({});
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleCheckboxChange = (day) => {
                setFormData(prev => {
                    const currentDays = prev.diasSemana || [];
                    if (currentDays.includes(day)) {
                        return { ...prev, diasSemana: currentDays.filter(d => d !== day) };
                    } else {
                        return { ...prev, diasSemana: [...currentDays, day] };
                    }
                });
            };

            const handleCategoryChange = (categoryKey, resourceType) => {
                setFormData(prev => {
                    const newState = { ...prev, [categoryKey]: !prev[categoryKey] };
                    
                    // If unchecked, remove all resources of that type from selection
                    if (!newState[categoryKey]) {
                        const idsToRemove = recursos.filter(r => r.tipo === resourceType).map(r => r.id);
                        newState.recursosIds = (prev.recursosIds || []).filter(id => !idsToRemove.includes(id));
                    }
                    return newState;
                });
            };

            const handleResourceToggle = (resourceId) => {
                setFormData(prev => {
                    const currentResources = prev.recursosIds || [];
                    if (currentResources.includes(resourceId)) {
                        return { ...prev, recursosIds: currentResources.filter(id => id !== resourceId) };
                    } else {
                        return { ...prev, recursosIds: [...currentResources, resourceId] };
                    }
                });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                // Dispatch based on type
                if (modalConfig.type.includes('demanda')) {
                    if (modalConfig.type === 'create_demanda') setDemandas([...demandas, { ...formData, id: `D-2025-${demandas.length + 1}` }]);
                    else setDemandas(demandas.map(d => d.id === formData.id ? formData : d));
                } 
                else if (modalConfig.type.includes('curso')) {
                    // Cleanup UI flags before saving
                    const { catInfra, catEquip, catInsumo, ...cleanData } = formData;
                    if (modalConfig.type === 'create_curso') setCursos([...cursos, { ...cleanData, id: cursos.length + 1 }]);
                    else setCursos(cursos.map(c => c.id === cleanData.id ? cleanData : c));
                }
                else if (modalConfig.type.includes('docente')) {
                    if (modalConfig.type === 'create_docente') setDocentes([...docentes, { ...formData, id: docentes.length + 1 }]);
                    else setDocentes(docentes.map(d => d.id === formData.id ? formData : d));
                }
                else if (modalConfig.type.includes('recurso')) {
                    if (modalConfig.type === 'create_recurso') setRecursos([...recursos, { ...formData, id: recursos.length + 1 }]);
                    else setRecursos(recursos.map(r => r.id === formData.id ? formData : r));
                }
                closeModal();
            };

            // Derived state for filtering
            const getFilteredDocentes = () => {
                if (!formData.curso) return [];
                const selectedCourseObj = cursos.find(c => c.titulo === formData.curso);
                if (!selectedCourseObj) return [];
                return docentes.filter(d => d.area === selectedCourseObj.area);
            };

            // Modal Content Routing
            const renderModalBody = () => {
                const type = modalConfig.type;
                
                // FORM: CURSOS (ATUALIZADO COM CATEGORIAS E FILTRO DE AREA)
                if (type === 'create_curso' || type === 'edit_curso') {
                    // Logica de filtro de recursos
                    const filteredResources = recursos.filter(r => {
                        const isSameArea = r.area === formData.area;
                        const isGeneral = r.area === 'Geral';
                        return isSameArea || isGeneral;
                    });

                    return (
                        <form id="modal-form" onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Título do Curso</label>
                                <input type="text" name="titulo" value={formData.titulo || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Área Tecnológica</label>
                                    <select name="area" value={formData.area || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                        {AREAS_TECNOLOGICAS.filter(a => a !== 'Geral').map(a => <option key={a} value={a}>{a}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Carga Horária (h)</label>
                                    <input type="number" name="ch" value={formData.ch || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" required />
                                </div>
                            </div>
                            
                            {/* CATEGORIZAÇÃO DE RECURSOS */}
                            <div className="border-t border-gray-100 pt-4 mt-2">
                                <div className="flex justify-between items-center mb-3">
                                    <h4 className="text-sm font-bold text-gray-900 flex items-center gap-2">
                                        <i data-lucide="layers" className="w-4 h-4"></i> Recursos Necessários
                                    </h4>
                                    <span className="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded border border-blue-100">
                                        Filtrando por: {formData.area} + Geral
                                    </span>
                                </div>
                                
                                <div className="space-y-4">
                                    {/* Categoria Infraestrutura */}
                                    <div className="border rounded-md p-3 bg-white">
                                        <label className="flex items-center gap-2 font-medium text-sm text-gray-800 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={formData.catInfra || false} 
                                                onChange={() => handleCategoryChange('catInfra', 'Infraestrutura')}
                                                className="rounded text-purple-600 focus:ring-purple-500"
                                            />
                                            Infraestrutura
                                        </label>
                                        {formData.catInfra && (
                                            <div className="mt-3 ml-6 pl-3 border-l-2 border-purple-100 space-y-2">
                                                {filteredResources.filter(r => r.tipo === 'Infraestrutura').map(r => (
                                                    <label key={r.id} className="flex items-start gap-2 text-sm text-gray-600 cursor-pointer hover:text-gray-900">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={(formData.recursosIds || []).includes(r.id)} 
                                                            onChange={() => handleResourceToggle(r.id)}
                                                            className="mt-1 rounded text-purple-600 focus:ring-purple-500"
                                                        />
                                                        <span>
                                                            {r.nome} 
                                                            {r.area === 'Geral' && <span className="ml-1 text-[10px] bg-gray-100 text-gray-500 px-1 rounded border">Geral</span>}
                                                        </span>
                                                    </label>
                                                ))}
                                                {filteredResources.filter(r => r.tipo === 'Infraestrutura').length === 0 && <span className="text-xs text-gray-400 block py-1">Nenhum recurso disponível para esta área.</span>}
                                            </div>
                                        )}
                                    </div>

                                    {/* Categoria Equipamentos */}
                                    <div className="border rounded-md p-3 bg-white">
                                        <label className="flex items-center gap-2 font-medium text-sm text-gray-800 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={formData.catEquip || false} 
                                                onChange={() => handleCategoryChange('catEquip', 'Equipamento')}
                                                className="rounded text-orange-600 focus:ring-orange-500"
                                            />
                                            Equipamentos
                                        </label>
                                        {formData.catEquip && (
                                            <div className="mt-3 ml-6 pl-3 border-l-2 border-orange-100 space-y-2">
                                                {filteredResources.filter(r => r.tipo === 'Equipamento').map(r => (
                                                    <label key={r.id} className="flex items-start gap-2 text-sm text-gray-600 cursor-pointer hover:text-gray-900">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={(formData.recursosIds || []).includes(r.id)} 
                                                            onChange={() => handleResourceToggle(r.id)}
                                                            className="mt-1 rounded text-orange-600 focus:ring-orange-500"
                                                        />
                                                        <span>
                                                            {r.nome}
                                                            {r.area === 'Geral' && <span className="ml-1 text-[10px] bg-gray-100 text-gray-500 px-1 rounded border">Geral</span>}
                                                        </span>
                                                    </label>
                                                ))}
                                                {filteredResources.filter(r => r.tipo === 'Equipamento').length === 0 && <span className="text-xs text-gray-400 block py-1">Nenhum recurso disponível para esta área.</span>}
                                            </div>
                                        )}
                                    </div>

                                    {/* Categoria Insumos */}
                                    <div className="border rounded-md p-3 bg-white">
                                        <label className="flex items-center gap-2 font-medium text-sm text-gray-800 cursor-pointer">
                                            <input 
                                                type="checkbox" 
                                                checked={formData.catInsumo || false} 
                                                onChange={() => handleCategoryChange('catInsumo', 'Insumo')}
                                                className="rounded text-teal-600 focus:ring-teal-500"
                                            />
                                            Insumos
                                        </label>
                                        {formData.catInsumo && (
                                            <div className="mt-3 ml-6 pl-3 border-l-2 border-teal-100 space-y-2">
                                                {filteredResources.filter(r => r.tipo === 'Insumo').map(r => (
                                                    <label key={r.id} className="flex items-start gap-2 text-sm text-gray-600 cursor-pointer hover:text-gray-900">
                                                        <input 
                                                            type="checkbox" 
                                                            checked={(formData.recursosIds || []).includes(r.id)} 
                                                            onChange={() => handleResourceToggle(r.id)}
                                                            className="mt-1 rounded text-teal-600 focus:ring-teal-500"
                                                        />
                                                        <span>
                                                            {r.nome}
                                                            {r.area === 'Geral' && <span className="ml-1 text-[10px] bg-gray-100 text-gray-500 px-1 rounded border">Geral</span>}
                                                        </span>
                                                    </label>
                                                ))}
                                                {filteredResources.filter(r => r.tipo === 'Insumo').length === 0 && <span className="text-xs text-gray-400 block py-1">Nenhum recurso disponível para esta área.</span>}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </form>
                    );
                }

                // FORM: RECURSOS (Atualizado com Condicionais)
                if (type === 'create_recurso' || type === 'edit_recurso') {
                    return (
                         <form id="modal-form" onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Nome do Recurso</label>
                                <input type="text" name="nome" value={formData.nome || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" placeholder="Ex: Projetor, Cozinha..." required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Área de Aplicação</label>
                                    <select name="area" value={formData.area || 'Geral'} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                        {AREAS_TECNOLOGICAS.map(a => <option key={a} value={a}>{a}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Tipo</label>
                                    <select name="tipo" value={formData.tipo || 'Infraestrutura'} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                        <option value="Infraestrutura">Infraestrutura (Sala, Lab)</option>
                                        <option value="Equipamento">Equipamento (Máquina, Kit)</option>
                                        <option value="Insumo">Insumo (Consumível)</option>
                                    </select>
                                </div>
                            </div>

                            {/* CAMPOS CONDICIONAIS */}
                            {formData.tipo === 'Infraestrutura' && (
                                <div className="animate-fade-in">
                                    <label className="block text-sm font-medium text-gray-700">Descrição / Especificação</label>
                                    <textarea name="descricao" value={formData.descricao || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" rows="3" placeholder="Ex: Sala com 30 cadeiras, ar condicionado..."></textarea>
                                </div>
                            )}

                            {formData.tipo === 'Equipamento' && (
                                <div className="animate-fade-in space-y-4">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">NI (Patrimônio)</label>
                                            <input type="text" name="ni" value={formData.ni || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" placeholder="Ex: 001234" />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Quantidade</label>
                                            <input type="number" name="quantidade" value={formData.quantidade || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Observações</label>
                                        <textarea name="observacoes" value={formData.observacoes || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" rows="2" placeholder="Estado de conservação, voltagem..."></textarea>
                                    </div>
                                </div>
                            )}

                            {formData.tipo === 'Insumo' && (
                                <div className="animate-fade-in space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Descrição</label>
                                        <input type="text" name="descricao" value={formData.descricao || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" placeholder="Ex: Farinha de Trigo Tipo 1" />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Unidade de Medida</label>
                                            <select name="unidadeMedida" value={formData.unidadeMedida || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                <option value="">Selecione...</option>
                                                <option value="Unidade">Unidade</option>
                                                <option value="Kg">Kg</option>
                                                <option value="Litro">Litro</option>
                                                <option value="Pacote">Pacote</option>
                                                <option value="Caixa">Caixa</option>
                                                <option value="Metro">Metro</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Quantidade</label>
                                            <input type="number" name="quantidade" value={formData.quantidade || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" />
                                        </div>
                                    </div>
                                </div>
                            )}
                        </form>
                    );
                }

                // FORM: DOCENTES
                if (type === 'create_docente' || type === 'edit_docente') {
                    return (
                        <form id="modal-form" onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700">Nome Completo</label>
                                <input type="text" name="nome" value={formData.nome || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md" required />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Área Principal</label>
                                    <select name="area" value={formData.area || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                        {AREAS_TECNOLOGICAS.filter(a => a !== 'Geral').map(a => <option key={a} value={a}>{a}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Tipo de Contrato</label>
                                    <select name="contrato" value={formData.contrato || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                        <option>Horista</option>
                                        <option>CLT</option>
                                        <option>Prestador</option>
                                        <option>Recurso Móvel</option>
                                    </select>
                                </div>
                            </div>
                            
                            {/* SEÇÃO DE DISPONIBILIDADE */}
                            <div className="border-t border-gray-100 pt-4 mt-2">
                                <h4 className="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                                    <i data-lucide="calendar-clock" className="w-4 h-4"></i> Disponibilidade de Carga Horária
                                </h4>
                                
                                <div className="mb-4">
                                    <label className="block text-xs text-gray-500 mb-2">Dias da Semana Disponíveis</label>
                                    <div className="flex gap-2 flex-wrap">
                                        {DAYS_OPTIONS.map(day => {
                                            const isSelected = (formData.diasSemana || []).includes(day);
                                            return (
                                                <button 
                                                    key={day}
                                                    type="button"
                                                    onClick={() => handleCheckboxChange(day)}
                                                    className={`px-3 py-1 text-xs rounded border transition-colors ${isSelected ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                                                >
                                                    {day}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-xs text-gray-500 mb-1">Horário Início Preferencial</label>
                                        <input type="time" name="horaInicio" value={formData.horaInicio || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" />
                                    </div>
                                    <div>
                                        <label className="block text-xs text-gray-500 mb-1">Horário Fim Preferencial</label>
                                        <input type="time" name="horaFim" value={formData.horaFim || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" />
                                    </div>
                                </div>
                            </div>
                        </form>
                    );
                }

                // FORM: DEMANDAS (Original)
                const filteredDocentes = getFilteredDocentes();
                const selectedCourseObj = cursos.find(c => c.titulo === formData.curso);

                return (
                    <form id="modal-form" onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="col-span-2">
                            <label className="block text-sm font-medium text-gray-700 mb-1">Curso</label>
                            <select name="curso" value={formData.curso || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md bg-white" required>
                                <option value="">Selecione...</option>
                                {cursos.map(c => <option key={c.id} value={c.titulo}>{c.titulo}</option>)}
                            </select>
                             {selectedCourseObj && (
                                <div className="text-xs text-blue-600 mt-1">
                                    Área: {selectedCourseObj.area} | CH: {selectedCourseObj.ch}h
                                </div>
                            )}
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Solicitante</label>
                            <select name="solicitante" value={formData.solicitante || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md bg-white" required>
                                <option value="">Selecione...</option>
                                {MOCK_SOLICITANTES.map(s => <option key={s} value={s}>{s}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Município</label>
                            <select name="municipio" value={formData.municipio || ''} onChange={handleInputChange} className="w-full p-2 border rounded-md bg-white" required>
                                <option value="">Selecione...</option>
                                {MOCK_MUNICIPIOS.map(m => <option key={m} value={m}>{m}</option>)}
                            </select>
                        </div>
                         {/* SEÇÃO DE DATAS */}
                         <div className="col-span-2 border-t border-gray-100 pt-4 mt-2">
                            <h4 className="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <i data-lucide="calendar-range" className="w-4 h-4"></i> Período e Dias
                            </h4>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-xs text-gray-500 mb-1">Data Início</label>
                                    <input type="date" name="dataInicio" value={formData.dataInicio || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" required />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-500 mb-1">Data Término</label>
                                    <input type="date" name="dataTermino" value={formData.dataTermino || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" required />
                                </div>
                            </div>
                            <div>
                                <label className="block text-xs text-gray-500 mb-2">Dias da Semana</label>
                                <div className="flex gap-2 flex-wrap">
                                    {DAYS_OPTIONS.map(day => {
                                        const isSelected = (formData.diasSemana || []).includes(day);
                                        return (
                                            <button 
                                                key={day}
                                                type="button"
                                                onClick={() => handleCheckboxChange(day)}
                                                className={`px-3 py-1 text-xs rounded border transition-colors ${isSelected ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'}`}
                                            >
                                                {day}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* SEÇÃO DE HORÁRIOS */}
                        <div className="col-span-2 border-b border-gray-100 pb-4 mb-2">
                            <h4 className="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <i data-lucide="clock" className="w-4 h-4"></i> Horário Diário
                            </h4>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-xs text-gray-500 mb-1">Hora Início</label>
                                    <input type="time" name="horaInicio" value={formData.horaInicio || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" required />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-500 mb-1">Hora Fim</label>
                                    <input type="time" name="horaFim" value={formData.horaFim || ''} onChange={handleInputChange} className="w-full p-2 border border-gray-300 rounded-md" required />
                                </div>
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select name="status" value={formData.status || 'Solicitado'} onChange={handleInputChange} className="w-full p-2 border rounded-md bg-white">
                                <option>Solicitado</option><option>Programado</option><option>Realizado</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Docente (Filtrado por Área)</label>
                            <select 
                                name="docente" 
                                value={formData.docente || ''} 
                                onChange={handleInputChange} 
                                className="w-full p-2 border rounded-md bg-white disabled:bg-gray-100 disabled:text-gray-400"
                                disabled={!formData.curso || filteredDocentes.length === 0}
                            >
                                <option value="">
                                    {!formData.curso ? "Selecione um curso primeiro" : 
                                     filteredDocentes.length === 0 ? "Nenhum docente nesta área" : 
                                     "Selecione um docente..."}
                                </option>
                                {filteredDocentes.map(d => <option key={d.id} value={d.nome}>{d.nome} ({d.contrato})</option>)}
                            </select>
                        </div>
                    </form>
                );
            }

            // Sidebar Navigation Item
            const NavItem = ({ id, icon, label }) => (
                <button 
                    onClick={() => setView(id)} 
                    className={`w-full flex items-center gap-3 px-4 py-3 text-sm font-medium transition-colors rounded-lg mb-1
                        ${view === id ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900'}`}
                >
                    <i data-lucide={icon} className="w-5 h-5"></i>
                    {label}
                </button>
            );

            return (
                <div className="min-h-screen flex bg-gray-50">
                    {/* SIDEBAR */}
                    <aside className="w-64 bg-white border-r border-gray-200 fixed h-full z-20 flex flex-col">
                        <div className="p-6 flex items-center gap-3 border-b border-gray-100 h-16">
                            <div className="bg-blue-700 text-white p-1.5 rounded font-bold text-lg tracking-tighter">SB</div>
                            <h1 className="text-lg font-bold text-gray-800 tracking-tight">SGD-A</h1>
                        </div>
                        <nav className="p-4 flex-1 overflow-y-auto">
                            <div className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-4">Principal</div>
                            <NavItem id="demandas" icon="layout-dashboard" label="Gestão de Demandas" />
                            
                            <div className="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-4 mt-6">Cadastros Centrais</div>
                            <NavItem id="docentes" icon="users" label="Base de Docentes" />
                            <NavItem id="cursos" icon="book-open" label="Catálogo de Cursos" />
                            <NavItem id="recursos" icon="box" label="Gestão de Recursos" />
                        </nav>
                        <div className="p-4 border-t border-gray-100">
                             <div className="flex items-center gap-3 px-4 py-2">
                                <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-xs">G</div>
                                <div className="flex flex-col">
                                    <span className="text-sm font-medium text-gray-700">Gestor</span>
                                    <span className="text-xs text-gray-400">Admin</span>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 ml-64 p-8">
                        <div className="max-w-6xl mx-auto">
                            {view === 'demandas' && <DemandasView demandas={demandas} openModal={openModal} viewMode={demandasViewMode} setViewMode={setDemandasViewMode} onEventClick={(d) => openModal('edit_demanda', d)} />}
                            {view === 'docentes' && <DocentesView docentes={docentes} onAdd={() => openModal('create_docente')} onEdit={(d) => openModal('edit_docente', d)} />}
                            {view === 'cursos' && <CursosView cursos={cursos} recursos={recursos} onAdd={() => openModal('create_curso')} onEdit={(c) => openModal('edit_curso', c)} />}
                            {view === 'recursos' && <RecursosView recursos={recursos} onAdd={() => openModal('create_recurso')} onEdit={(r) => openModal('edit_recurso', r)} />}
                        </div>
                    </main>

                    {/* MODAL GLOBAL */}
                    <Modal 
                        isOpen={modalConfig.isOpen} 
                        onClose={closeModal} 
                        title={
                            modalConfig.type?.includes('create') ? 'Novo Registro' : 
                            modalConfig.type?.includes('edit') ? 'Editar Registro' : 'Detalhes'
                        }
                        footer={
                            <>
                                <Button onClick={closeModal} variant="secondary">Cancelar</Button>
                                <Button onClick={handleSubmit} variant="primary">Salvar</Button>
                            </>
                        }
                    >
                        {renderModalBody()}
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>